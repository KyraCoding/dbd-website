<!DOCTYPE html>
<html>
  <head>
    <title>Perks By Daylight: A DBD buildcrafting tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              mono: ['"Roboto Mono"', "sans-serif"],
            },
            colors: {},
          },
        },
      };
    </script>
  </head>
  <body class="bg-slate-950 font-mono text-white">
    <div class="flex flex-col items-center p-6">
      <div class="flex text-5xl font-bold">Perks By Daylight</div>
      <div class="flex text-2xl">
        A Dead By Daylight buildcrafting tool by KyraCoding
      </div>
    </div>
    <div id="perksList" class="flex flex-col items-center gap-3 p-6">
      <h1 id="perkCount" class="flex text-xl font-bold">
        Search for perks: (<%= data.length+" perks found"%>)
      </h1>
      <input id="search" class="flex w-1/2 p-3 justify-center text-black rounded">
      <div class="flex p-3 justify-center gap-6 rounded bg-slate-600">
        <% tags.forEach((tag) => { %>
          <div class="flex bg-rose-400 rounded p-2 cursor-pointer hover:bg-rose-500" onclick=tagClick(this)>
            <%= tag %>
          </div>
        <% }) %>
      </div>
      <% data.forEach((perk) => { %>
        <div class="flex flex-row w-2/3 h-fit bg-slate-600 rounded" data-name="<%= perk.name %>" data-tags="<%= perk.tags %>">
          <div class="flex flex-col bg-purple-950 w-1/3 p-3">
            <img src=<%= perk.img %> class="flex justify-self-center w-full">
          </div>
          <div class="flex flex-col w-2/3 border-l">
            <div class="flex flex-col p-3 border-b gap-3">
              <div class="flex text-white text-xl font-bold"><%= perk.name %></div>
              <div class="flex text-white text-xl"><%= perk.character+" Perk" %></div>
            </div>
            <div class="flex flex-col p-3 border-b">
              <div class="flex text-white text-lg"><%= perk.description %></div>
              <br>
              <div class="flex text-white text-lg italic"><%= perk.flavorText %></div>
            </div>
            <div class="flex flex-row w-full h-fit p-3 gap-6 flex-wrap text-sm font-bold">
              <% perk.tags.forEach((tag) => { %>
                <div class="flex bg-rose-400 rounded p-2">
                  <%= tag %>
                </div>
              <% }) %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
    <script>
      var currentQuery = ""
      var currentTags = []
      function adjustPlurality(inp) {
         if (inp == 1) {
           return ""
         } else {
           return "s" 
         }
       }
      document.getElementById("search").addEventListener("input", event => {
        const perks = document.querySelectorAll('[data-name]');
        var counter = 0
        currentQuery = event.target.value
        perks.forEach((perk) => {
          if (perk.dataset.name.toLowerCase().indexOf(currentQuery.toLowerCase()) > -1) {
            perk.classList.remove("hidden")
            counter++
          } else {
            perk.classList.add("hidden")
          }
        })
        document.getElementById("perkCount").innerHTML = "Search for perks: ("+counter+" perk"+adjustPlurality(counter)+" found)"
      })
      function tagClick(element) {
        var tagName = element.innerHTML 
        if (currentTags.includes(tagName)) {
          currentTags.filter(item => item !== tagName)
        } else {
          currentTags.push(tagName)
        }
      }
    </script>
  </body>
</html>
